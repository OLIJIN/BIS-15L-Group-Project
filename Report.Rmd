---
title: "Project"
output:
  html_document: default
  pdf_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Library Imports
```{r libraries, warning=FALSE, message=FALSE}
#install.packages("adegenet")
library(adegenet)
library(ggplot2)
library(tidyverse)
library(here)
library(janitor)
library("gapminder")
```

## Import Dataset

```{r datasetImport}
week_gene <- read.csv("data/weeks_genotypes.csv")
head(week_gene)
```

## Determine Heterozygosity
```{r heterozygosity}
alleles <- week_gene[,4:ncol(week_gene)]
genind_alleles <- df2genind(alleles,sep="/",NA.char="NA/NA")
heterozygosity_results <- summary(genind_alleles)
heterozygosity_results
```

## Heterozygosity by Population
```{r popheterozygosity}
pop_geind_alleles <- seppop(df2genind(alleles,sep="/",NA.char="NA/NA", pop=week_gene$Pop))
pop_geind_alleles
```

## Group by Population
```{r popsummary}
MtBuller <- summary(pop_geind_alleles$MtBuller)
MtHiggenbotham <- summary(pop_geind_alleles$MtHigginbotham)
MtBuller
```

## Create dataframes for comparing observed and expected
```{r compare}
MtBullerDf <- data.frame(unlist(MtBuller$Hobs), unlist(MtBuller$Hexp))
names(MtBullerDf) <- c("Hobs", "Hexp")
MtHiggenbothamDf <- data.frame(unlist(MtHiggenbotham$Hobs), unlist(MtHiggenbotham$Hexp))
names(MtHiggenbothamDf) <- c("Hobs", "Hexp")
head(MtBullerDf)
```

## Dataframes Pivoted on Observation Type
```{r pivotCols}
category <- rep(c("Observed", "Expected"), each=length(MtBullerDf$Hobs))
MtBullerPivot <- data.frame(c(seq(1, 24, 1), seq(1, 24, 1)), c(MtBullerDf$Hobs, MtBullerDf$Hexp), category)
MtHiggenbothamPivot <- data.frame(c(seq(1, 24, 1), seq(1, 24, 1)), c(MtHiggenbothamDf$Hobs, MtHiggenbothamDf$Hexp), category)
names(MtBullerPivot) <- c("Location", "Heterozygosity", "Type")
names(MtHiggenbothamPivot) <- c("Location", "Heterozygosity", "Type")
head(MtBullerPivot)
```

## Boxplot Comparison MtBuller
```{r boxplotbuller}
MtBullerPivot %>% 
  ggplot(aes(x=Type, y=Heterozygosity)) + geom_boxplot(na.rm=T) + coord_flip()
```

## Boxplot Comparison MtHiggenbotham
```{r boxplothiggenbotham}
MtHiggenbothamPivot %>% 
  ggplot(aes(x=Type, y=Heterozygosity)) + geom_boxplot(na.rm=T) + coord_flip()
```

## Barplot Comparison MtBuller
```{r barplotbuller}
MtBullerPivot %>%
  ggplot(aes(x=Location, y=Heterozygosity, fill=Type)) + geom_bar(stat="identity", position = "identity", alpha=.3, na.rm=T)
```

## Barplot Comparison MtHiggenbotham
```{r barplothiggenbotham}
MtHiggenbothamPivot %>%
  ggplot(aes(x=Location, y=Heterozygosity, fill=Type)) + geom_bar(stat="identity", position = "identity", alpha=.3, na.rm=T)
```

## Scatterplot Comparison of Observed between MtBuller and MtHiggenbotham
```{r scatterobs}
combindedPop <- rbind(MtBullerDf, MtHiggenbothamDf)
combindedPop$Population <- rep(c("MtBuller", "MtHiggenbotham"), each=24)
combindedPop$Location <- c(seq(1, 24, 1), seq(1, 24, 1))
combindedPop %>% 
  ggplot(aes(x=Location, y=Hobs, color=Population)) + geom_point()
```

## Scatterplot Comparison of Expected between MtBuller and MtHiggenbotham
```{r scatterexp}
combindedPop %>% 
  ggplot(aes(x=Location, y=Hexp, color=Population)) + geom_point()
```
```{r}
MtBullerDf %>%
  mutate(Hdiff= Hobs - Hexp) %>%
  arrange(desc(Hdiff))
```

```{r}
MtBullerPivot %>%
  filter(Location %in% c("2","6","1","7","14")) %>%
  ggplot(aes(x=Type, y = Heterozygosity, fill = Type))+ 
  geom_col(alpha=0.8)+
  facet_grid(.~Location)+
  theme(axis.text.x = element_text(angle = 60, hjust = 1)) +
  theme(plot.title = element_text(size = rel(1), face='bold', hjust = 0.5)) +
  labs(title = "Top 5 Microsatellite Loci with Higher than Expected Heterozygosity (MtBuller)",
       x="Type",
       y="Heterozygosity")
```
```{r}
MtHiggenbothamDf %>%
  mutate(Hdiff= Hobs - Hexp) %>%
  arrange(desc(Hdiff))
```
```{r}
MtHiggenbothamPivot %>%
  filter(Location %in% c("2","17","5","9","4")) %>%
  ggplot(aes(x=Type, y = Heterozygosity, fill = Type))+ 
  geom_col(alpha=0.8)+
  facet_grid(.~Location)+
  theme(axis.text.x = element_text(angle = 60, hjust = 1)) +
  theme(plot.title = element_text(size = rel(1), face='bold', hjust = 0.5)) +
  labs(title = "Top 5 Microsatellite Loci with Higher than Expected Heterozygosity (MtHiggenbotham)",
       x="Type",
       y="Heterozygosity")
```

# Most Heterozygous Locus
```{r}
MtBullerDf %>%
  mutate(Heteroz = abs(Hobs - 0.5)) %>%
  arrange(Heteroz)
```
```{r}
MtHiggenbothamDf %>%
  mutate(Heteroz = abs(Hobs - 0.5)) %>%
  arrange(Heteroz)
```




